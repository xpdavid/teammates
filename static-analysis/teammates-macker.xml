<?xml version="1.0"?>
<macker>
    <ruleset name="UI should not touch storage">
        <access-rule>
            <deny>
                <from class="teammates.ui.*" />
                <to class="teammates.storage.*" />
            </deny>
        </access-rule>
    </ruleset>
    <ruleset name="Logic should not access entity directly">
        <access-rule>
            <deny>
                <from class="teammates.logic.core.*" />
                <to class="teammates.storage.entity.*" />
                <allow>
                    <!-- Should fix this in the future -->
                    <to class="teammates.storage.entity.FeedbackResponse" />
                </allow>
            </deny>
        </access-rule>
    </ruleset>
    <ruleset name="Each logic can only access its corresponding DB">
        <foreach var="logicModule" class="teammates.logic.core.(*)Logic">
            <pattern name="DbModule" class="teammates.storage.api.${logicModule}Db" />
            
            <access-rule>  
                <message>${logicModule} can only access its corresponding DB</message>
                <deny> 
                    <from class="teammates.logic.core.${logicModule}Logic" />
                    <to class="teammates.storage.api.*" /> 
                    <allow>
                        <to pattern="DbModule"></to>
                    </allow>
                </deny>
            </access-rule>
        </foreach>
    </ruleset>
    <ruleset name="Test cases should not be dependent on each other">
        <var name="testCasesPackage" value="teammates.test.cases" />
        <access-rule>
            <deny>
                <from class="${testCasesPackage}.**" />
                <to class="${testCasesPackage}.**" />
                <allow>
                    <!-- allow dependency from inner class -->
                    <from class="${testCasesPackage}.**$**" />
                </allow>
                <allow>
                    <!-- allow dependency to inner class -->
                    <to class="${testCasesPackage}.**$**" />
                </allow>
                <allow>
                    <!-- allow dependency to base class -->
                    <to class="${testCasesPackage}.**Base**" />
                </allow>
                <allow>
                    <!-- allow dependency from Feedback*QuestionUiTest to FeedbackQuestionUiTest -->
                    <from class="${testCasesPackage}.browsertests.Feedback*QuestionUiTest" />
                    <to class="${testCasesPackage}.browsertests.FeedbackQuestionUiTest" />
                </allow>
            </deny>
        </access-rule>
    </ruleset>
    <ruleset name="(Automated)Action Test case should not depends on logic and storage">
        <pattern name="actionTest">
            <include class="teammates.test.cases.action.*" />
            <include class="teammates.test.cases.automated.*" />
        </pattern>
        <pattern name="appLogic">
            <include class="teammates.logic.*" />
            <include class="teammates.storage.*" />
        </pattern>
        <access-rule>
            <deny>
                <from pattern="actionTest" ></from>
                <to pattern="appLogic" />
            </deny>
        </access-rule>
    </ruleset>
    <ruleset name="Only UI tests can access page object classes">
        <access-rule>
            <deny>
                <from class="teammates.test.**" />
                <to class="teammates.test.pageobjects.*" />
                <allow>
                    <!-- allow dependency within the package -->
                    <from class="teammates.test.pageobjects.*" />
                </allow>
                <allow>
                    <!-- allow dependency from UI tests -->
                    <from class="teammates.test.cases.browsertests.*" />
                </allow>
            </deny>
        </access-rule>
    </ruleset>
</macker>
